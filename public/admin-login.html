<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Nyumbani – Admin Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; padding: 0; background: #020617; color: #e5e7eb; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
      .card { background: #0b1120; border-radius: 12px; padding: 2rem 2.5rem; max-width: 420px; width: 100%; box-shadow: 0 20px 40px rgba(15,23,42,0.9); border: 1px solid #f59e0b55; }
      h1 { margin: 0 0 0.25rem; font-size: 1.6rem; display: flex; align-items: center; gap: 0.5rem; }
      h1 span.badge { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.08em; padding: 0.15rem 0.5rem; border-radius: 999px; border: 1px solid #f59e0b; color: #f59e0b; }
      p.subtitle { margin: 0 0 1.5rem; color: #9ca3af; font-size: 0.9rem; }
      label { display: block; margin-bottom: 0.25rem; font-size: 0.85rem; color: #d1d5db; }
      input { width: 100%; padding: 0.55rem 0.7rem; border-radius: 0.5rem; border: 1px solid #374151; background: #020617; color: #e5e7eb; font-size: 0.9rem; box-sizing: border-box; }
      input:focus { outline: none; border-color: #f59e0b; box-shadow: 0 0 0 1px #f59e0b44; }
      .field { margin-bottom: 0.9rem; }
      button { width: 100%; padding: 0.6rem 0.8rem; border-radius: 999px; border: none; background: #f59e0b; color: #02131b; font-weight: 600; cursor: pointer; font-size: 0.95rem; }
      button:hover { background: #d97706; }
      button:disabled { opacity: 0.6; cursor: default; }
      .status { margin-top: 0.8rem; min-height: 1.1rem; font-size: 0.8rem; }
      .status.error { color: #f97373; }
      .status.success { color: #4ade80; }
      .alt-links { margin-top: 1.2rem; font-size: 0.8rem; color: #9ca3af; }
      .alt-links a { color: #22c55e; text-decoration: none; }
      .alt-links a:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <main class="card">
      <h1>
        Nyumbani
        <span class="badge">Admin</span>
      </h1>
      <p class="subtitle">Restricted area for the team reviewing applications and platform activity.</p>
      <form id="admin-login-form">
        <div class="field">
          <label for="email">Admin email</label>
          <input id="email" name="email" type="email" required autocomplete="email" />
        </div>
        <div class="field">
          <label for="password">Password</label>
          <input id="password" name="password" type="password" required autocomplete="current-password" />
        </div>
        <button type="submit" id="submit-btn">Sign in as admin</button>
        <div id="status" class="status"></div>
      </form>
      <div class="alt-links">
        <div>Need a regular account? <a href="/register">Create user account</a></div>
        <div>Back to user login: <a href="/login">User login</a></div>
      </div>
    </main>

    <script>
      const form = document.getElementById('admin-login-form');
      const statusEl = document.getElementById('status');
      const submitBtn = document.getElementById('submit-btn');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        statusEl.textContent = '';
        statusEl.className = 'status';
        submitBtn.disabled = true;
        submitBtn.textContent = 'Signing in...';

        const email = form.email.value.trim();
        const password = form.password.value;

        try {
          const res = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password }),
          });

          const data = await res.json().catch(() => ({}));

          if (!res.ok || !data.success) {
            const msg = (data && (data.message || (data.errors && data.errors[0]?.msg))) || 'Login failed';
            statusEl.textContent = msg;
            statusEl.className = 'status error';
          } else if (!data.data || !data.data.user || data.data.user.role !== 'admin') {
            statusEl.textContent = 'This account is not an admin. Please use an admin account.';
            statusEl.className = 'status error';
          } else {
            statusEl.textContent = 'Admin login successful. You can now access the admin dashboard via API.';
            statusEl.className = 'status success';
          }
        } catch (err) {
          statusEl.textContent = 'Network error – please try again.';
          statusEl.className = 'status error';
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'Sign in as admin';
        }
      });
    </script>
  </body>
</html>
