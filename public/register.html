<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Nyumbani – Create Account</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; padding: 0; background: #0f172a; color: #e5e7eb; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
      .card { background: #020617; border-radius: 12px; padding: 2rem 2.5rem; max-width: 440px; width: 100%; box-shadow: 0 20px 40px rgba(15,23,42,0.8); border: 1px solid #1f2937; }
      h1 { margin: 0 0 0.25rem; font-size: 1.6rem; }
      p.subtitle { margin: 0 0 1.5rem; color: #9ca3af; font-size: 0.9rem; }
      label { display: block; margin-bottom: 0.25rem; font-size: 0.85rem; color: #d1d5db; }
      input { width: 100%; padding: 0.55rem 0.7rem; border-radius: 0.5rem; border: 1px solid #374151; background: #020617; color: #e5e7eb; font-size: 0.9rem; box-sizing: border-box; }
      input:focus { outline: none; border-color: #22c55e; box-shadow: 0 0 0 1px #22c55e33; }
      .field { margin-bottom: 0.9rem; }
      button { width: 100%; padding: 0.6rem 0.8rem; border-radius: 999px; border: none; background: #22c55e; color: #022c22; font-weight: 600; cursor: pointer; font-size: 0.95rem; }
      button:hover { background: #16a34a; }
      button:disabled { opacity: 0.6; cursor: default; }
      .status { margin-top: 0.8rem; min-height: 1.1rem; font-size: 0.8rem; }
      .status.error { color: #f97373; }
      .status.success { color: #4ade80; }
      .alt-links { margin-top: 1.2rem; font-size: 0.8rem; color: #9ca3af; }
      .alt-links a { color: #22c55e; text-decoration: none; }
      .alt-links a:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <main class="card">
      <h1>Join the Nyumbani Circle</h1>
      <p class="subtitle">Create your account to save applications and access future features.</p>
      <form id="register-form">
        <div class="field">
          <label for="name">Full name</label>
          <input id="name" name="name" type="text" required autocomplete="name" />
        </div>
        <div class="field">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required autocomplete="email" />
        </div>
        <div class="field">
          <label for="password">Password</label>
          <input id="password" name="password" type="password" required autocomplete="new-password" />
        </div>
        <div class="field">
          <label for="passwordConfirm">Confirm password</label>
          <input id="passwordConfirm" name="passwordConfirm" type="password" required autocomplete="new-password" />
        </div>
        <button type="submit" id="submit-btn">Create account</button>
        <div id="status" class="status"></div>
      </form>
      <div class="alt-links">
        <div>Already have an account? <a href="/login">Sign in</a></div>
        <div>Admin? <a href="/admin/login">Go to admin login</a></div>
      </div>
    </main>

    <script>
      const form = document.getElementById('register-form');
      const statusEl = document.getElementById('status');
      const submitBtn = document.getElementById('submit-btn');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        statusEl.textContent = '';
        statusEl.className = 'status';

        const name = form.name.value.trim();
        const email = form.email.value.trim();
        const password = form.password.value;
        const passwordConfirm = form.passwordConfirm.value;

        if (password !== passwordConfirm) {
          statusEl.textContent = 'Passwords do not match.';
          statusEl.className = 'status error';
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Creating account...';

        try {
          const res = await fetch('/api/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email, password }),
          });

          const data = await res.json().catch(() => ({}));

          if (!res.ok || !data.success) {
            const msg = (data && (data.message || (data.errors && data.errors[0]?.msg))) || 'Sign up failed';
            statusEl.textContent = msg;
            statusEl.className = 'status error';
          } else {
            statusEl.textContent = 'Account created! You can now sign in.';
            statusEl.className = 'status success';
          }
        } catch (err) {
          statusEl.textContent = 'Network error – please try again.';
          statusEl.className = 'status error';
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'Create account';
        }
      });
    </script>
  </body>
</html>
